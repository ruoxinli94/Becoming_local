<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Becoming - AI Coach</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        /* Additional styles for the chat interface */
        body {
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            height: 100vh;
        }
        
        .chat-container {
            max-width: 480px;
            margin: 0 auto;
            background-color: #f8f9fa;
            height: 100vh;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            flex-shrink: 0;
        }
        
        .chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            padding-bottom: 80px; /* Ensure enough space for footer */
            display: flex;
            flex-direction: column;
        }
        
        .message {
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            max-width: 80%;
        }
        
        .bot-message {
            background-color: #e8e8fa;
            align-self: flex-start;
        }
        
        .user-message {
            background-color: #fff9c4;
            align-self: flex-end;
        }
        
        .suggestion {
            background-color: #e0f7e0;
            align-self: flex-end;
            margin-left: auto;
            padding: 10px 15px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .chat-footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 480px;
            padding: 10px;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            z-index: 100;
        }
        
        .input-container {
            display: flex;
            align-items: center;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 25px;
            padding: 5px 15px;
        }
        
        .message-input {
            flex: 1;
            border: none;
            outline: none;
            padding: 10px;
            background: transparent;
        }
        
        .voice-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #333;
            font-size: 1.2rem;
        }

        /* Markdown styling */
        .bot-message ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        .bot-message strong {
            font-weight: 600;
        }
        
        .bot-message p {
            margin-bottom: 10px;
        }
        
        .bot-message p:last-child {
            margin-bottom: 0;
        }
        
        .waiting {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-radius: 20px;
            background-color: #e8e8fa;
            align-self: flex-start;
            margin-bottom: 15px;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #6c5ce7;
            margin: 0 2px;
            animation: bounce 1.4s infinite;
        }
        
        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes bounce {
            0%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-8px);
            }
        }
        
        /* Cursor animation for typing effect */
        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 16px;
            background-color: #333;
            margin-left: 2px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
        }
        
        /* Action button styling */
        .action-button {
            background-color: #6c5ce7;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 15px auto;
            display: block;
            transition: all 0.3s ease;
        }
        
        .action-button:hover {
            background-color: #5649c0;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .action-container {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        /* Envelope button styling */
        .envelope-button {
            background-color: #ffd43b;
            color: #5a4800;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 15px auto;
            display: block;
            transition: all 0.3s ease;
        }
        
        .envelope-button:hover {
            background-color: #fcc419;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        /* Growth plan styling */
        .growth-plan-container {
            background-color: #f5f2e8;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            align-self: stretch;
        }
        
        .growth-plan-year {
            font-weight: 700;
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 5px;
        }
        
        .growth-plan-desc {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 15px;
        }
        
        .confirm-plan-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 15px auto;
            display: block;
            transition: all 0.3s ease;
        }
        
        .confirm-plan-button:hover {
            background-color: #3e8e41;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Chat messages area -->
        <div class="chat-body" id="chatBody">
            <!-- Initial bot messages will be added via JS for typing effect -->
        </div>
        
        <!-- Chat input area -->
        <div class="chat-footer">
            <div class="input-container">
                <input type="text" class="message-input" placeholder="Type a message..." autofocus>
                <button class="voice-btn">
                    <i class="fas fa-microphone"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const messageInput = document.querySelector('.message-input');
            const voiceButton = document.querySelector('.voice-btn');
            const chatBody = document.getElementById('chatBody');
            
            // Set chat container width to match footer width
            function adjustContainerWidth() {
                const footerWidth = document.querySelector('.chat-footer').offsetWidth;
                document.querySelector('.chat-container').style.maxWidth = footerWidth + 'px';
            }
            
            // Check if returning from exploration, comparison, or future self
            const urlParams = new URLSearchParams(window.location.search);
            const returnFromExploration = urlParams.get('returnFromExploration');
            const returnFromComparison = urlParams.get('returnFromComparison');
            const showGrowthPlan = urlParams.get('showGrowthPlan');
            
            // Run on load and on resize
            adjustContainerWidth();
            window.addEventListener('resize', adjustContainerWidth);
            
            // Function to create a message container
            function createMessageContainer(isBot) {
                const messageDiv = document.createElement('div');
                messageDiv.className = isBot ? 'message bot-message' : 'message user-message';
                return messageDiv;
            }
            
            // Function to simulate typing effect - faster, more like Claude's speed
            function typeText(element, html, onComplete) {
                // Super fast Claude-like typing effect
                // Just display entire content at once with minimal animation for speed
                element.innerHTML = html;
                
                // Check for Future Self Letter mention in the message
                if (html.includes('Future Self Letter')) {
                    setTimeout(() => {
                        // If the letter is mentioned but no envelope button is present, add it
                        if (!document.querySelector('.envelope-button')) {
                            addEnvelopeButton();
                        }
                    }, 100);
                }
                
                // Call completion callback immediately
                if (onComplete) {
                    setTimeout(onComplete, 50);
                }
            }
            
            // Optional typing indicator - very brief display
            function showTypingIndicator() {
                // For Claude-like instant responses, we can optionally skip this
                // But keeping a very brief indicator for UX feedback
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'waiting';
                typingIndicator.innerHTML = `
                    <div class="typing-indicator">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                `;
                typingIndicator.id = 'typingIndicator';
                chatBody.appendChild(typingIndicator);
                scrollToBottom();
                
                // Auto-hide after a very short time if not manually hidden
                setTimeout(() => {
                    const indicator = document.getElementById('typingIndicator');
                    if (indicator) {
                        indicator.remove();
                    }
                }, 200);
            }
            
            // Function to hide typing indicator
            function hideTypingIndicator() {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.remove();
                }
            }
            
            // Improved scroll function
            function scrollToBottom() {
                chatBody.scrollTop = chatBody.scrollHeight;
                
                // Double-check scroll position after a short delay
                // (fixes issues with content still loading)
                setTimeout(() => {
                    chatBody.scrollTop = chatBody.scrollHeight;
                }, 100);
            }
            
            // If showing growth plan after future self commitment
            if (showGrowthPlan === 'true') {
                // Clear URL parameter to avoid loading the plan again on refresh
                window.history.replaceState({}, document.title, 'chatbot.html');
                
                // Display welcome back message
                const welcomeMessageContainer = createMessageContainer(true);
                typeText(welcomeMessageContainer, `<p>Congratulations on committing to your future self! Based on your letter, I've created a 5-year growth plan to help you become a Director/VP of Product in GenAI.</p>`);
                chatBody.appendChild(welcomeMessageContainer);
                
                // Add intro message for growth plan
                setTimeout(() => {
                    const introMessageContainer = createMessageContainer(true);
                    typeText(introMessageContainer, `<p>This plan is designed to help you move steadily toward your goal while maintaining the work-life balance and job satisfaction you value. Take a look at your growth journey:</p>`);
                    chatBody.appendChild(introMessageContainer);
                    
                    // Add growth plan container
                    setTimeout(() => {
                        const growthPlanHTML = `
                            <div class="growth-plan-container">
                                <div class="growth-plan-year">Year 5: Director/VP of Product</div>
                                <div class="growth-plan-desc"></div>
                                
                                <div class="growth-plan-year">Year 4: Develop Strategic Impact</div>
                                <div class="growth-plan-desc">Make a wider impact across the organization and refine strategic thinking</div>
                                
                                <div class="growth-plan-year">Year 3: Take on Leadership</div>
                                <div class="growth-plan-desc">Start taking on greater leadership responsibilities, using a progress tracker to monitor growth</div>
                                
                                <div class="growth-plan-year">Year 2: Gain Visibility</div>
                                <div class="growth-plan-desc">Work on getting more org-wide visibility, by leveraging community support</div>
                                
                                <div class="growth-plan-year">Year 1: Build Core Skills</div>
                                <div class="growth-plan-desc">Focus on developing core product management competencies, with growth plan guiding progress</div>
                            </div>
                        `;
                        
                        chatBody.insertAdjacentHTML('beforeend', growthPlanHTML);
                        scrollToBottom();
                        
                        // Add question about the plan
                        setTimeout(() => {
                            const questionMessageContainer = createMessageContainer(true);
                            typeText(questionMessageContainer, `<p>How does this plan look to you? Would you like to adjust any aspects of it before we begin implementing Year 1?</p>`);
                            chatBody.appendChild(questionMessageContainer);
                            
                            // Add confirm button
                            setTimeout(() => {
                                const actionContainer = document.createElement('div');
                                actionContainer.className = 'action-container';
                                
                                const confirmButton = document.createElement('button');
                                confirmButton.className = 'confirm-plan-button';
                                confirmButton.innerHTML = 'Confirm Plan <i class="fas fa-check-circle ms-2"></i>';
                                confirmButton.addEventListener('click', function() {
                                    window.location.href = 'calendar-connect.html';
                                });
                                
                                actionContainer.appendChild(confirmButton);
                                chatBody.appendChild(actionContainer);
                                scrollToBottom();
                            }, 200);
                        }, 300);
                    }, 300);
                }, 300);
            } else {
                // Load the original chat content
                const originalChatHTML = `
                    <div class="message bot-message">
                        <p>Thanks for letting us know you, Ke! Let me summarize your profile:</p>
                        <p><strong>üåü Ke's Profile Summary</strong></p>
                        <ul>
                            <li><strong>Current Title</strong>: Senior Product Manager, GenAI</li>
                            <li><strong>Future Aspiration</strong>: Director/VP of Product, GenAI</li>
                            <li><strong>Career Stage</strong>: Mid-career</li>
                            <li><strong>Top Priorities</strong>: Job stability, work-life balance, job satisfaction</li>
                            <li><strong>Clarity on Career Goal</strong>: ‚úÖ Yes</li>
                            <li><strong>Time Horizon for Goal</strong>: ‚è≥ 1‚Äì5 years</li>
                            <li><strong>Change Motivation Style</strong>:
                                <ul>
                                    <li>‚úÖ Community support over coach/mentor</li>
                                    <li>‚úÖ Words of encouragement over progress tracker</li>
                                    <li>‚úÖ Curated reading list over online courses</li>
                                </ul>
                            </li>
                            <li><strong>Personality</strong>: üîä Extrovert</li>
                        </ul>
                    </div>
                    
                    <div class="message bot-message">
                        <p>I got a little creative, here's my understanding of you, how did I do?</p>
                        <p><strong>üíº Career Goal Statement</strong></p>
                        <p>You're aiming to grow from a Sr PM in GenAI into a Director or VP role within a 5 year horizon, where you can lead with impact while maintaining life balance, stability, and joy in your work.</p>
                        <p><strong>üîÆ Behavioral Prediction</strong></p>
                        <p>You thrive on energy, connection, and momentum. You're driven, vocal, and inspired by people around you. Supportive communities and uplifting encouragement keep you moving forward. You learn best through engaging, real-world insights ‚Äî not just structured content. When making changes, you take bold steps when you feel emotionally lit up and socially supported.</p>
                    </div>
                `;
                
                chatBody.innerHTML = originalChatHTML;
            }
            
            // Function to add "Open the envelope" button
            function addEnvelopeButton() {
                // Check if the envelope button already exists
                if (document.querySelector('.envelope-button')) {
                    return; // Don't add it again if it already exists
                }
                
                const envelopeContainer = document.createElement('div');
                envelopeContainer.className = 'action-container';
                
                const envelopeButton = document.createElement('button');
                envelopeButton.className = 'envelope-button';
                envelopeButton.innerHTML = 'Open the envelope <i class="fas fa-envelope-open ms-2"></i>';
                envelopeButton.addEventListener('click', function() {
                    window.location.href = 'future-self.html';
                });
                
                envelopeContainer.appendChild(envelopeButton);
                chatBody.appendChild(envelopeContainer);
                scrollToBottom();
            }
            
            // Handle sending messages
            function sendMessage() {
                const message = messageInput.value.trim();
                if (message) {
                    // Create user message element
                    const userMessage = document.createElement('div');
                    userMessage.className = 'message user-message';
                    userMessage.innerHTML = `<p>${message}</p>`;
                    
                    // Add to chat
                    chatBody.appendChild(userMessage);
                    
                    // Clear input
                    messageInput.value = '';
                    
                    // Scroll to bottom
                    scrollToBottom();
                    
                    // Show typing indicator
                    showTypingIndicator();
                    
                    // Bot response for growth plan confirmation
                    if (showGrowthPlan === 'true' || document.querySelector('.growth-plan-container')) {
                        setTimeout(() => {
                            hideTypingIndicator();
                            
                            const botResponse = createMessageContainer(true);
                            let responseText = '';
                            
                            if (message.toLowerCase().includes('look') && message.toLowerCase().includes('good') ||
                                message.toLowerCase().includes('yes') ||
                                message.toLowerCase().includes('confirm') ||
                                message.toLowerCase().includes('great') ||
                                message.toLowerCase().includes('like it')) {
                                responseText = `<p>Great! I'm glad you like the plan. Let's get started with implementing Year 1: Building Core Skills. Click "Confirm Plan" to continue to your detailed growth plan.</p>`;
                            }
                            else if (message.toLowerCase().includes('change') || 
                                     message.toLowerCase().includes('adjust') ||
                                     message.toLowerCase().includes('modify')) {
                                responseText = `<p>What specific adjustments would you like to make to the plan? I can help customize it to better fit your needs and preferences.</p>`;
                            }
                            else {
                                responseText = `<p>Thank you for your feedback! Would you like to proceed with this growth plan or would you prefer to make some adjustments before we begin?</p>`;
                            }
                            
                            typeText(botResponse, responseText);
                            chatBody.appendChild(botResponse);
                            scrollToBottom();
                        }, 500);
                    }
                    // Default bot response
                    else {
                        setTimeout(() => {
                            hideTypingIndicator();
                            
                            const botResponse = createMessageContainer(true);
                            const responseText = `<p>Thank you for your message! Is there anything specific about your career development journey you'd like to explore further?</p>`;
                            
                            typeText(botResponse, responseText);
                            chatBody.appendChild(botResponse);
                            scrollToBottom();
                        }, 500);
                    }
                }
            }
            
            // Send message on button click
            voiceButton.addEventListener('click', function() {
                if (messageInput.value.trim()) {
                    sendMessage();
                }
            });
            
            // Send message on Enter key
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Handle window resize to ensure proper scrolling
            window.addEventListener('resize', scrollToBottom);
            
            // Ensure everything is scrolled to bottom on initial load
            setTimeout(scrollToBottom, 500);
        });
    </script>
</body>
</html>
